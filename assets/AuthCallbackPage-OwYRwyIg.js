import{u as e,d as r,a as i,r as o,j as s,c as a,s as t}from"./index-D4sJXgjp.js";function n(){const n=e(),[l]=r(),{user:d}=i();return o.useEffect((()=>{(async()=>{var e,r;try{const i=l.get("error"),o=l.get("error_description"),s=l.get("code");if(i)return a.error(o||"Authentication failed. Please try again."),void n("/login");if(!s)return a.error("Authentication failed. Please try again."),void n("/login");const{data:{session:d},error:u}=await t.auth.exchangeCodeForSession(s);if(u)return a.error("Failed to get session. Please try again."),void n("/login");if(null==d?void 0:d.user){const{data:i,error:o}=await t.from("profiles").select("*").eq("id",d.user.id).single();if(o&&"PGRST116"!==o.code)return a.error("Failed to load user profile"),void n("/login");if(!i){const{error:i}=await t.from("profiles").insert([{id:d.user.id,email:d.user.email,full_name:(null==(e=d.user.user_metadata)?void 0:e.full_name)||(null==(r=d.user.email)?void 0:r.split("@")[0]),user_type:"customer"}]);if(i)return a.error("Failed to create user profile. Please try again."),void n("/login")}const s=(null==i?void 0:i.user_type)||"customer";n("provider"===s?"/dashboard":"/browse")}else a.error("No user session found"),n("/login")}catch(i){a.error("Authentication failed. Please try again."),n("/login")}})()}),[n,l]),s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})}export{n as default};
