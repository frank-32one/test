import{u as e,d as r,a as i,r as s,j as o,c as a,s as t}from"./index-CAkYLr-q.js";function n(){const n=e(),[l]=r(),{user:d}=i();return s.useEffect((()=>{(async()=>{var e,r;try{const i=l.get("error"),s=l.get("error_description");if(i)return a.error(s||"Authentication failed. Please try again."),void n("/login");const{data:{session:o},error:d}=await t.auth.getSession();if(d)return a.error("Failed to get session. Please try again."),void n("/login");if(null==o?void 0:o.user){const{data:i,error:s}=await t.from("profiles").select("*").eq("id",o.user.id).single();if(s&&"PGRST116"!==s.code)return a.error("Failed to load user profile"),void n("/login");if(!i){const{error:i}=await t.from("profiles").insert([{id:o.user.id,email:o.user.email,full_name:(null==(e=o.user.user_metadata)?void 0:e.full_name)||(null==(r=o.user.email)?void 0:r.split("@")[0]),user_type:"customer"}]);if(i)return a.error("Failed to create user profile. Please try again."),void n("/login")}const l=(null==i?void 0:i.user_type)||"customer";n("provider"===l?"/dashboard":"/browse")}else a.error("No user session found"),n("/login")}catch(i){a.error("Authentication failed. Please try again."),n("/login")}})()}),[n,l]),o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})})}export{n as default};
